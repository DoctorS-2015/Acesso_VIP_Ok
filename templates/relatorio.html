<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Relatório de Acessos</title>
  <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="p-4 bg-light">
  <a href="/" class="btn btn-sm btn-outline-primary rounded-circle" 
   style="position: fixed; top: 20px; right: 20px; z-index: 999;" 
   title="Início">
  <i class="bi bi-house"></i>
</a>
  <h2 class="mb-4">Relatório de Acessos</h2>

  <!-- Estatísticas -->
  <div class="mb-4">
    <h5>Estatísticas:</h5>
    <ul class="list-group list-group-horizontal">
      <li class="list-group-item">Total: <span class="badge bg-primary">{{ total }}</span></li>
      <li class="list-group-item">Liberados: <span class="badge bg-success">{{ liberados }}</span></li>
      <li class="list-group-item">Negados: <span class="badge bg-danger">{{ negados }}</span></li>
    </ul>
  </div>

  <!-- Gráfico -->
  <div class="my-4">
    <canvas id="graficoAcessos" height="100"></canvas>
  </div>
  <script>
    const ctx = document.getElementById('graficoAcessos').getContext('2d');
    new Chart(ctx, {
      type: 'bar',
      data: {
        labels: ['Liberados', 'Negados'],
        datasets: [{
          label: 'Total',
          data: [{{ liberados }}, {{ negados }}],
          backgroundColor: ['rgba(25, 135, 84, 0.7)', 'rgba(220, 53, 69, 0.7)'],
          borderColor: ['rgba(25, 135, 84, 1)', 'rgba(220, 53, 69, 1)'],
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });
  </script>

  <!-- Filtros -->
  <form method="get" class="d-flex flex-wrap gap-3 mb-3">
    <select name="ingresso" class="form-select">
      <option value="">Todos os ingressos</option>
      <option value="ING123">ING123</option>
      <option value="ING456">ING456</option>
      <option value="ING789">ING789</option>
    </select>
    <select name="status" class="form-select">
      <option value="">Todos</option>
      <option value="Liberado">Liberado</option>
      <option value="Negado">Negado</option>
    </select>
    <input type="date" name="data_inicio" class="form-control">
    <input type="date" name="data_fim" class="form-control">
    <button type="submit" class="btn btn-dark"><i class="bi bi-funnel-fill"></i> Filtrar</button>
  </form>

  <!-- Exportação -->
  <form method="get" action="/exportar_csv">
    <input type="hidden" name="ingresso" value="{{ request.args.get('ingresso', '') }}">
    <input type="hidden" name="status" value="{{ request.args.get('status', '') }}">
    <input type="hidden" name="data_inicio" value="{{ request.args.get('data_inicio', '') }}">
    <input type="hidden" name="data_fim" value="{{ request.args.get('data_fim', '') }}">
    <button type="submit" class="btn btn-outline-success mb-3"><i class="bi bi-file-earmark-spreadsheet"></i> Exportar CSV</button>
  </form>

  <!-- Tabela -->
  <table class="table table-striped table-hover">
    <thead class="table-dark">
      <tr>
        <th>Nome</th>
        <th>Ingresso</th>
        <th>CPF</th>
        <th>Data</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for nome, ingresso, documento, data, status in dados %}
      <tr>
        <td>{{ nome }}</td>
        <td>{{ ingresso }}</td>
        <td>{{ documento }}</td>
        <td>{{ data }}</td>
        <td>{{ status }}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  <div class="mt-4 text-center">
    <a href="/logout" class="btn btn-outline-danger">
      <i class="bi bi-box-arrow-right"></i> Logout
    </a>
  </div>
  <form method="POST" action="/limpar_registros" style="position: fixed; bottom: 20px; right: 20px;">
    <button type="submit" class="btn btn-sm btn-outline-danger rounded-circle" title="Limpar registros">
      <i class="bi bi-trash"></i>
    </button>
  </form>
</body>
</html>
